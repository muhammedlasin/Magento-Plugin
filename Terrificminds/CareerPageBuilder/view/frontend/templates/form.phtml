<?php

 $log = $block->isUserStatus();
if ($log) {
    $customerName = $block->getCustomerData()->getFirstName() . " " . $block->getCustomerData()->getLastName();
    $customerEmail = $block->getCustomerData()->getEmail();
}
?>
<form action="<?= /* @noEscape */ $block->getSubmitUrl()?>" method="POST" enctype="multipart/form-data"
 data-mage-init='{"validation":{}}'>
    <fieldset class="fieldset">
        <legend class="legend"><span><?= $block->escapeHtmlAttr(__('Please fill in your details')) ?></span></legend>
        <fieldset class="fieldset row">
            <div class="fields col-md-6">
                <div class="field name required">
                    <label class="label" for="applicant_name">
                        <span><?= $block->escapeHtmlAttr(__('Name'))?></span>
                    </label>
                    <div class="control">
                        <input name="applicant_name" id="applicant_name" title="name" 
                               value="<?=$log ? $block->escapeHtmlAttr($customerName) : ""?>"
                               class="input-text required-entry" type="text" 
                               data-validate="{required:true}" required  />
                    </div>
                </div>
                <div class="field name required">
                    <label class="label" for="email">
                        <span><?= $block->escapeHtmlAttr(__('Email')) ?></span>
                    </label>
                    <div class="control">
                        <input name="email" id="email" title="Email"
                               value="<?=$log ? $block->escapeHtmlAttr($customerEmail) : ""?>"
                               class="input-text" type="email"
                               data-validate="{required:true, 'validate-email':true}" required/>
                    </div>
                </div>
                <div class="field name required">
                    <label class="label" for="address">
                        <span><?= $block->escapeHtmlAttr(__('Address')) ?></span>
                    </label>
                    <div class="control">
                        <textarea name="address" id="address" title="Address"
                               data-validate="{required:true}" required ></textarea>
                    </div>
                </div>

                <div class="field name required">
                    <label class="label" for="number">
                        <span><?= $block->escapeHtmlAttr(__('Phone Number')) ?></span>
                    </label>
                    <div class="control">
                        <input name="phone_number" id="phone_number" title="Phone Number"
                               class="input-text" type="number"
                               data-validate="{'validate-phoneLax':true}" required/>
                    </div>
                </div>

                <div class="field name required">
                    <label class="label" for="experience">
                        <span><?= $block->escapeHtmlAttr(__('Experience (in years)')) ?></span>
                    </label>
                    <div class="control">
                        <input name="experience" id="experience" title="Experience"
                        class="integer" type="number"
                               data-validate="{'validate-digits-range':'0-100'}" required/>
                    </div>
                </div>
                <div class="field name">
                    <label class="label" for="cover_letter">
                        <span><?= $block->escapeHtmlAttr(__('Cover Letter')) ?></span>
                    </label>
                    <div class="control">
                            <textarea name="cover_letter" id="cover_letter" title="Cover Letter" value=""
                             class="input-text" type="text"
                             data-validate="{'min-words':250, 'max-words':400 }"></textarea>
                        </div>
                </div>
                <div class="field name required">
                    <label class="label" for="resume">
                        <span><?= $block->escapeHtmlAttr(__('Upload Your Resume (pdf,doc,docx)')) ?></span>
                    </label>
                    <div class="control">
                    <input type="file" name="resume" id="resume" title="Upload Custom File" 
                    class="input-text required" required>
                </div>
            </div>
            </div>
            <br>
            <p id="warning" style="display:none;color: #e02b27;font-size: 1.2rem;">Invalid file type.</p>
            <p id="limit" style="display:none;color: #e02b27;font-size: 1.2rem;">
            The allowed file size is less than 1 MB</p>
            <input type="hidden" id="job_designation" name="job_designation"
             value="<?= /* @noEscape */ $block->getJobName()?>">    
        </fieldset>
    </fieldset>
    <div class="actions-toolbar">
        <div class="primary">
            <button type="submit" id="save" class="action submit primary" title="Save">
                <span><?= $block->escapeHtmlAttr(__('Save')) ?></span>
            </button>
        </div>
    </div>
</form>

<script>
window.onload = function () {
    document.getElementById("resume").onchange = function () {
        let fileName = this.value;
        let lastChar = fileName.substr(fileName.length - 3); 
        allowedFiles = ["pdf", "doc", "docx"];
        if(allowedFiles.indexOf(lastChar) == -1){
            document.getElementById("limit").style.display = "none"; 
            document.getElementById("warning").style.display = "block";    
            document.getElementById('save').disabled = true;
        }
        else{
            document.getElementById("warning").style.display = "none";     
            if(this.files[0].size > 1000000){
                document.getElementById("limit").style.display = "block";  
                document.getElementById('save').disabled = true;
            }
            else{
                document.getElementById('save').disabled = false;
                document.getElementById("limit").style.display = "none";  
            }
        }
    };
};
</script>